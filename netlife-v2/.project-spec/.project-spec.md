# 🛠️ Backend Engineering Spec: NetLife + Cranesurvey Integration

## 📌 Project Overview

**NetLife** is a digital health and service platform that:
- Provides personalized videos (screening results from Cranesurvey)
- Lists health/social services for users to request
- Uses WhatsApp-only login (no email/password)
- Integrates with an existing Cranesurvey PHP system

The backend is powered by **Supabase (Postgres, Auth, Edge Functions)**. Frontend is handled separately using **Next.js**.

---

## 👨‍💻 Backend Engineer Responsibilities

1. **Supabase Setup**
   - Define schema (Postgres SQL)
   - Enable RLS (Row-Level Security)
   - Secure all user data with policies

2. **WhatsApp Login**
   - Implement `send-code` to generate/send 6-digit OTP
   - Implement `verify-code` to validate OTP and create/login user
   - Use Meta Cloud API or Twilio for WhatsApp messaging

3. **Edge Functions (Supabase)**
   - `send-code`: public, sends WhatsApp OTP
   - `verify-code`: public, signs in/creates user
   - `screening-sync`: internal, syncs Cranesurvey videos
   - (Optional) `send-notification`: for alerts

4. **Integration with Cranesurvey (PHP)**
   - System lives at: `cranesurvey.netlife.cc`
   - It will POST screening results to our `screening-sync` function

5. **Frontend Handoff**
   - Provide: Supabase URL, anon key, edge function URLs, schema overview
   - Frontend uses Supabase JS SDK for auth and queries

---

## 📦 Core Tables

- `profiles`: extended user info (phone, etc.)
- `login_codes`: stores WhatsApp OTPs
- `videos`: video library
- `user_videos`: personalized recommendations (from screening)
- `services`: list of available services
- `service_requests`: service request tracking

---

## 🔐 Auth Flow

1. User enters WhatsApp number in frontend
2. Frontend calls `/send-code` (Edge Function)
3. User enters 6-digit code
4. Frontend calls `/verify-code` → returns Supabase session

---

## 🛠 Stack

- **Supabase** (Edge Functions, Postgres, RLS)
- **Deno** (for functions)
- **Twilio/Meta** (for WhatsApp messaging)
- **cPanel** (for PHP system hosting)

---

## 🧩 Status Tracker

- [x] Schema designed
- [x] Cranesurvey hosted
- [x] Domain: cranesurvey.netlife.cc
- [ ] Supabase CLI initialized
- [ ] WhatsApp API setup
- [ ] Edge functions deployed
- [ ] Frontend integration tested

---

## ✅ Progress & Completed Work

The following backend tasks are already completed:

- ✅ **Supabase project created** and environment is connected
- ✅ **Database schema designed and deployed**:
  - All core tables (`profiles`, `videos`, `user_videos`, `services`, `service_requests`, `login_codes`) created
  - Foreign key relationships are set up correctly
- ✅ **Subdomain for Cranesurvey (`cranesurvey.netlife.cc`) is active**
  - PHP system hosted via cPanel and tested locally
- ✅ **Initial testing of Supabase queries is successful**
- ✅ **Frontend-dev handover doc created** (includes keys, URLs, table overview)


*This file is used by backend engineers and AI tools to understand the backend architecture and deliverables.*
